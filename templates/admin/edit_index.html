{% extends "admin/base.html" %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è ‚Äî –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block admin_content %}
<div class="admin-page">
    <div class="admin-page__header">
        <h1>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h1>
        <p>–í—Å–µ —Å–µ–∫—Ü–∏–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: –≥–µ—Ä–æ–π, –∑–∞–ø—Ä–æ—Å—ã, –ø—Ä–µ–≤—å—é, –ø—Ä–æ—Ü–µ—Å—Å, CTA</p>
    </div>

    <form method="POST" class="admin-form" enctype="multipart/form-data">

        <!-- ‚ïê‚ïê‚ïê Hero ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üåü –ì–µ—Ä–æ–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è</h3>

            <!-- Hero Image -->
            <div class="admin-field">
                <label>–§–æ—Ç–æ –≥–µ—Ä–æ—è</label>
                {% if content.hero.image %}
                <div class="admin-image-preview" id="heroImageBlock">
                    <img src="{{ url_for('static', filename=content.hero.image) }}" alt="–§–æ—Ç–æ –≥–µ—Ä–æ—è" id="heroPreviewImg">
                    <div class="admin-image-preview__actions">
                        <label class="admin-btn admin-btn--outline admin-btn--sm">
                            –ó–∞–º–µ–Ω–∏—Ç—å
                            <input type="file" name="hero_image_file" accept="image/*" style="display:none" onchange="previewField(this, 'heroPreviewImg', 'heroRemoveImage')">
                        </label>
                        <button type="button" class="admin-btn admin-btn--danger admin-btn--sm" onclick="removeField('heroImageBlock', 'heroUploadZone', 'heroRemoveImage')">–£–¥–∞–ª–∏—Ç—å</button>
                        <input type="hidden" name="hero_remove_image" id="heroRemoveImage" value="0">
                    </div>
                </div>
                <div class="admin-upload-zone" id="heroUploadZone" style="display:none;">
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <input type="file" name="hero_image_file" accept="image/*" onchange="previewField(this, 'heroNewPreviewImg', 'heroRemoveImage')">
                </div>
                {% else %}
                <div class="admin-upload-zone" id="heroUploadZone">
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <input type="file" name="hero_image_file" accept="image/*" onchange="previewField(this, 'heroNewPreviewImg', null)">
                </div>
                {% endif %}
                <div id="heroNewPreview" style="display:none;" class="admin-image-preview">
                    <img id="heroNewPreviewImg" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                </div>
            </div>

            <div class="admin-field">
                <label for="hero_label">–ú–µ—Ç–∫–∞</label>
                <input type="text" id="hero_label" name="hero_label" value="{{ content.hero.label }}">
            </div>
            <div class="admin-field">
                <label for="hero_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (HTML –¥–æ–ø—É—Å—Ç–∏–º)</label>
                <input type="text" id="hero_title" name="hero_title" value="{{ content.hero.title }}">
            </div>
            <div class="admin-field">
                <label for="hero_text">–¢–µ–∫—Å—Ç</label>
                <textarea id="hero_text" name="hero_text" rows="3">{{ content.hero.text }}</textarea>
            </div>
            <div class="admin-field-row">
                <div class="admin-field">
                    <label for="hero_cta_text">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ CTA</label>
                    <input type="text" id="hero_cta_text" name="hero_cta_text" value="{{ content.hero.cta_text }}">
                </div>
                <div class="admin-field">
                    <label for="hero_secondary_cta_text">–¢–µ–∫—Å—Ç –≤—Ç–æ—Ä–æ–π –∫–Ω–æ–ø–∫–∏</label>
                    <input type="text" id="hero_secondary_cta_text" name="hero_secondary_cta_text" value="{{ content.hero.secondary_cta_text }}">
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Help Section ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üÜò –° —á–µ–º –ø–æ–º–æ–≥–∞—é</h3>
            <div class="admin-field">
                <label for="help_label">–ú–µ—Ç–∫–∞</label>
                <input type="text" id="help_label" name="help_label" value="{{ content.help_section.label }}">
            </div>
            <div class="admin-field">
                <label for="help_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="help_title" name="help_title" value="{{ content.help_section.title }}">
            </div>
            <div id="helpItems">
                {% for item in content.help_section['items'] %}
                <div class="admin-field admin-field--removable">
                    <textarea name="help_items" rows="2">{{ item }}</textarea>
                    <button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="admin-btn admin-btn--outline" onclick="addHelpItem()">+ –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç</button>
        </div>

        <!-- ‚ïê‚ïê‚ïê About Preview ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üë§ –ü—Ä–µ–≤—å—é ¬´–û–±–æ –º–Ω–µ¬ª</h3>

            <!-- About Preview Image -->
            <div class="admin-field">
                <label>–§–æ—Ç–æ ¬´–û–±–æ –º–Ω–µ¬ª</label>
                {% if content.about_preview.image %}
                <div class="admin-image-preview" id="aboutPrevImageBlock">
                    <img src="{{ url_for('static', filename=content.about_preview.image) }}" alt="–§–æ—Ç–æ" id="aboutPrevPreviewImg">
                    <div class="admin-image-preview__actions">
                        <label class="admin-btn admin-btn--outline admin-btn--sm">
                            –ó–∞–º–µ–Ω–∏—Ç—å
                            <input type="file" name="about_preview_image_file" accept="image/*" style="display:none" onchange="previewField(this, 'aboutPrevPreviewImg', 'aboutPrevRemoveImage')">
                        </label>
                        <button type="button" class="admin-btn admin-btn--danger admin-btn--sm" onclick="removeField('aboutPrevImageBlock', 'aboutPrevUploadZone', 'aboutPrevRemoveImage')">–£–¥–∞–ª–∏—Ç—å</button>
                        <input type="hidden" name="about_preview_remove_image" id="aboutPrevRemoveImage" value="0">
                    </div>
                </div>
                <div class="admin-upload-zone" id="aboutPrevUploadZone" style="display:none;">
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <input type="file" name="about_preview_image_file" accept="image/*" onchange="previewField(this, 'aboutPrevNewPreviewImg', 'aboutPrevRemoveImage')">
                </div>
                {% else %}
                <div class="admin-upload-zone" id="aboutPrevUploadZone">
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <input type="file" name="about_preview_image_file" accept="image/*" onchange="previewField(this, 'aboutPrevNewPreviewImg', null)">
                </div>
                {% endif %}
                <div id="aboutPrevNewPreview" style="display:none;" class="admin-image-preview">
                    <img id="aboutPrevNewPreviewImg" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                </div>
            </div>

            <div class="admin-field">
                <label for="about_preview_label">–ú–µ—Ç–∫–∞</label>
                <input type="text" id="about_preview_label" name="about_preview_label" value="{{ content.about_preview.label }}">
            </div>
            <div class="admin-field">
                <label for="about_preview_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="about_preview_title" name="about_preview_title" value="{{ content.about_preview.title }}">
            </div>
            <div id="aboutPreviewParas">
                {% for p in content.about_preview.paragraphs %}
                <div class="admin-field admin-field--removable">
                    <textarea name="about_preview_paragraph" rows="3">{{ p }}</textarea>
                    <button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="admin-btn admin-btn--outline" onclick="addAboutPreviewPara()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–≥—Ä–∞—Ñ</button>
            <div class="admin-field" style="margin-top: 1rem;">
                <label for="about_preview_cta_text">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
                <input type="text" id="about_preview_cta_text" name="about_preview_cta_text" value="{{ content.about_preview.cta_text }}">
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Services Preview ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üìã –ü—Ä–µ–≤—å—é —É—Å–ª—É–≥</h3>
            <div class="admin-field">
                <label for="services_preview_label">–ú–µ—Ç–∫–∞</label>
                <input type="text" id="services_preview_label" name="services_preview_label" value="{{ content.services_preview.label }}">
            </div>
            <div class="admin-field">
                <label for="services_preview_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="services_preview_title" name="services_preview_title" value="{{ content.services_preview.title }}">
            </div>
            <div class="admin-field">
                <label for="services_preview_subtitle">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <textarea id="services_preview_subtitle" name="services_preview_subtitle" rows="2">{{ content.services_preview.subtitle }}</textarea>
            </div>
            <div class="admin-field">
                <label for="services_preview_cta_text">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
                <input type="text" id="services_preview_cta_text" name="services_preview_cta_text" value="{{ content.services_preview.cta_text }}">
            </div>

            {% for item in content.services_preview['items'] %}
            <div class="admin-form__section admin-form__section--nested">
                <h4>{{ item.title }}</h4>
                <div class="admin-field">
                    <label>–ò–∫–æ–Ω–∫–∞</label>
                    <div class="icon-picker-field">
                        <div class="icon-picker-preview" id="iconPreview_sp_{{ loop.index0 }}"><i class="{{ item.icon }}"></i></div>
                        <input type="text" name="sp_{{ loop.index0 }}_icon" id="iconInput_sp_{{ loop.index0 }}" value="{{ item.icon }}" placeholder="fa-solid fa-handshake">
                        <button type="button" class="icon-picker-btn" onclick="openIconPicker('sp_{{ loop.index0 }}')">–í—ã–±—Ä–∞—Ç—å</button>
                    </div>
                </div>
                <div class="admin-field">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" name="sp_{{ loop.index0 }}_title" value="{{ item.title }}">
                </div>
                <div class="admin-field">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea name="sp_{{ loop.index0 }}_text" rows="2">{{ item.text }}</textarea>
                </div>
                <div class="admin-field">
                    <label>–¶–µ–Ω–∞</label>
                    <input type="text" name="sp_{{ loop.index0 }}_price" value="{{ item.price }}">
                </div>
                <div class="admin-field">
                    <label>–°—Å—ã–ª–∫–∞ –Ω–∞ —É—Å–ª—É–≥—É <small style="color:#999">(ID —É—Å–ª—É–≥–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ¬´–£—Å–ª—É–≥–∏¬ª)</small></label>
                    <input type="text" name="sp_{{ loop.index0 }}_link_id" value="{{ item.link_id|default('', true) }}">
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ‚ïê‚ïê‚ïê Process Steps ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üîÑ –ö–∞–∫ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</h3>
            <div class="admin-field">
                <label for="process_label">–ú–µ—Ç–∫–∞</label>
                <input type="text" id="process_label" name="process_label" value="{{ content.process_steps.label }}">
            </div>
            <div class="admin-field">
                <label for="process_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="process_title" name="process_title" value="{{ content.process_steps.title }}">
            </div>
            {% for step in content.process_steps.steps %}
            <div class="admin-form__section admin-form__section--nested">
                <h4>–®–∞–≥ {{ loop.index }}</h4>
                <div class="admin-field">
                    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —à–∞–≥–∞</label>
                    <input type="text" name="process_step_{{ loop.index0 }}_title" value="{{ step.title }}">
                </div>
                <div class="admin-field">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞</label>
                    <textarea name="process_step_{{ loop.index0 }}_text" rows="2">{{ step.text }}</textarea>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ‚ïê‚ïê‚ïê CTA ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üì¢ CTA-—Å–µ–∫—Ü–∏—è (–Ω–∏–∂–Ω–∏–π –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é)</h3>
            <div class="admin-field">
                <label for="cta_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="cta_title" name="cta_title" value="{{ content.cta.title }}">
            </div>
            <div class="admin-field">
                <label for="cta_text">–¢–µ–∫—Å—Ç</label>
                <textarea id="cta_text" name="cta_text" rows="2">{{ content.cta.text }}</textarea>
            </div>
            <div class="admin-field">
                <label for="cta_button_text">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
                <input type="text" id="cta_button_text" name="cta_button_text" value="{{ content.cta.button_text }}">
            </div>
        </div>

        <button type="submit" class="admin-btn admin-btn--primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë</button>
    </form>
</div>

<script>
function addHelpItem() {
    const container = document.getElementById('helpItems');
    const div = document.createElement('div');
    div.className = 'admin-field admin-field--removable';
    div.innerHTML = '<textarea name="help_items" rows="2" placeholder="–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç..."></textarea><button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>';
    container.appendChild(div);
}

function addAboutPreviewPara() {
    const container = document.getElementById('aboutPreviewParas');
    const div = document.createElement('div');
    div.className = 'admin-field admin-field--removable';
    div.innerHTML = '<textarea name="about_preview_paragraph" rows="3" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ..."></textarea><button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>';
    container.appendChild(div);
}

function previewField(input, imgId, removeId) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.getElementById(imgId);
            img.src = e.target.result;
            img.parentElement.style.display = '';
        };
        reader.readAsDataURL(input.files[0]);
        if (removeId) {
            document.getElementById(removeId).value = '0';
        }
    }
}

function removeField(blockId, zoneId, removeId) {
    document.getElementById(blockId).style.display = 'none';
    document.getElementById(zoneId).style.display = '';
    document.getElementById(removeId).value = '1';
}
</script>
{% endblock %}
