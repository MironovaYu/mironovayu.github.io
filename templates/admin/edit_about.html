{% extends "admin/base.html" %}
{% block title %}–û–±–æ –º–Ω–µ ‚Äî –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block admin_content %}
<div class="admin-page">
    <div class="admin-page__header">
        <h1>–°—Ç—Ä–∞–Ω–∏—Ü–∞ ¬´–û–±–æ –º–Ω–µ¬ª</h1>
        <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–µ, –ø–æ–¥—Ö–æ–¥, –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è, –ø—Ä–∏–Ω—Ü–∏–ø—ã</p>
    </div>

    <form method="POST" class="admin-form" enctype="multipart/form-data">

        <!-- ‚ïê‚ïê‚ïê Main Info ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üë§ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

            <!-- About Photo -->
            <div class="admin-field">
                <label>–§–æ—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞</label>
                {% if content.about_page.image %}
                <div class="admin-image-preview" id="aboutImageBlock">
                    <img src="{{ url_for('static', filename=content.about_page.image) }}" alt="–§–æ—Ç–æ" id="aboutPreviewImg">
                    <div class="admin-image-preview__actions">
                        <label class="admin-btn admin-btn--outline admin-btn--sm">
                            –ó–∞–º–µ–Ω–∏—Ç—å
                            <input type="file" name="about_image_file" accept="image/*" style="display:none" onchange="previewField(this, 'aboutPreviewImg', 'aboutRemoveImage')">
                        </label>
                        <button type="button" class="admin-btn admin-btn--danger admin-btn--sm" onclick="removeField('aboutImageBlock', 'aboutUploadZone', 'aboutRemoveImage')">–£–¥–∞–ª–∏—Ç—å</button>
                        <input type="hidden" name="about_remove_image" id="aboutRemoveImage" value="0">
                    </div>
                </div>
                <div class="admin-upload-zone" id="aboutUploadZone" style="display:none;">
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <input type="file" name="about_image_file" accept="image/*" onchange="previewField(this, 'aboutNewPreviewImg', 'aboutRemoveImage')">
                </div>
                {% else %}
                <div class="admin-upload-zone" id="aboutUploadZone">
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <input type="file" name="about_image_file" accept="image/*" onchange="previewField(this, 'aboutNewPreviewImg', null)">
                </div>
                {% endif %}
                <div id="aboutNewPreview" style="display:none;" class="admin-image-preview">
                    <img id="aboutNewPreviewImg" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                </div>
            </div>

            <div class="admin-field">
                <label for="name">–ò–º—è</label>
                <input type="text" id="name" name="name" value="{{ content.about_page.name }}">
            </div>
            <div class="admin-field">
                <label for="role">–†–æ–ª—å / –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</label>
                <input type="text" id="role" name="role" value="{{ content.about_page.role }}">
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Intro Paragraphs ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üìù –í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã</h3>
            <div id="introParas">
                {% for p in content.about_page.intro_paragraphs %}
                <div class="admin-field admin-field--removable">
                    <textarea name="intro_paragraph" rows="3">{{ p }}</textarea>
                    <button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="admin-btn admin-btn--outline" onclick="addParagraph()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–≥—Ä–∞—Ñ</button>
        </div>

        <!-- ‚ïê‚ïê‚ïê Approach ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üéØ –ú–æ–π –ø–æ–¥—Ö–æ–¥</h3>
            <div class="admin-field">
                <label for="approach_label">–ú–µ—Ç–∫–∞</label>
                <input type="text" id="approach_label" name="approach_label" value="{{ content.about_page.approach.label }}">
            </div>
            <div class="admin-field">
                <label for="approach_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="approach_title" name="approach_title" value="{{ content.about_page.approach.title }}">
            </div>
            <div class="admin-field">
                <label for="approach_subtitle">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <textarea id="approach_subtitle" name="approach_subtitle" rows="2">{{ content.about_page.approach.subtitle }}</textarea>
            </div>
            {% for item in content.about_page.approach['items'] %}
            <div class="admin-form__section admin-form__section--nested">
                <h4>–ü—É–Ω–∫—Ç {{ item.num }}</h4>
                <div class="admin-field">
                    <label>–ù–æ–º–µ—Ä</label>
                    <input type="text" name="approach_{{ loop.index0 }}_num" value="{{ item.num }}">
                </div>
                <div class="admin-field">
                    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                    <input type="text" name="approach_{{ loop.index0 }}_title" value="{{ item.title }}">
                </div>
                <div class="admin-field">
                    <label>–¢–µ–∫—Å—Ç</label>
                    <textarea name="approach_{{ loop.index0 }}_text" rows="3">{{ item.text }}</textarea>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ‚ïê‚ïê‚ïê Qualifications ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—ã—Ç</h3>
            <div class="admin-field">
                <label for="quals_label">–ú–µ—Ç–∫–∞</label>
                <input type="text" id="quals_label" name="quals_label" value="{{ content.about_page.qualifications.label }}">
            </div>
            <div class="admin-field">
                <label for="quals_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="quals_title" name="quals_title" value="{{ content.about_page.qualifications.title }}">
            </div>
            {% for item in content.about_page.qualifications['items'] %}
            <div class="admin-form__section admin-form__section--nested">
                <h4>{{ item.title }}</h4>
                <div class="admin-field">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <input type="text" name="qual_{{ loop.index0 }}_year" value="{{ item.year }}">
                </div>
                <div class="admin-field">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" name="qual_{{ loop.index0 }}_title" value="{{ item.title }}">
                </div>
                <div class="admin-field">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea name="qual_{{ loop.index0 }}_desc" rows="2">{{ item.desc }}</textarea>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ‚ïê‚ïê‚ïê Principles ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üíé –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã</h3>
            <div class="admin-field">
                <label for="princ_label">–ú–µ—Ç–∫–∞</label>
                <input type="text" id="princ_label" name="princ_label" value="{{ content.about_page.principles.label }}">
            </div>
            <div class="admin-field">
                <label for="princ_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="princ_title" name="princ_title" value="{{ content.about_page.principles.title }}">
            </div>
            {% for item in content.about_page.principles['items'] %}
            <div class="admin-form__section admin-form__section--nested">
                <h4>{{ item.title }}</h4>
                <div class="admin-field">
                    <label>–ò–∫–æ–Ω–∫–∞</label>
                    <div class="icon-picker-field">
                        <div class="icon-picker-preview" id="iconPreview_princ_{{ loop.index0 }}">{% if item.icon and 'fa-' in item.icon %}<i class="{{ item.icon }}"></i>{% elif item.icon %}{{ item.icon }}{% else %}<i class="fa-solid fa-icons" style="opacity:0.3"></i>{% endif %}</div>
                        <input type="text" name="princ_{{ loop.index0 }}_icon" id="iconInput_princ_{{ loop.index0 }}" value="{{ item.icon }}" placeholder="fa-solid fa-heart">
                        <button type="button" class="icon-picker-btn" onclick="openIconPicker('princ_{{ loop.index0 }}')">–í—ã–±—Ä–∞—Ç—å</button>
                    </div>
                </div>
                <div class="admin-field">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" name="princ_{{ loop.index0 }}_title" value="{{ item.title }}">
                </div>
                <div class="admin-field">
                    <label>–¢–µ–∫—Å—Ç</label>
                    <textarea name="princ_{{ loop.index0 }}_text" rows="2">{{ item.text }}</textarea>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ‚ïê‚ïê‚ïê CTA ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üì¢ CTA-—Å–µ–∫—Ü–∏—è</h3>
            <div class="admin-field">
                <label for="cta_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="cta_title" name="cta_title" value="{{ content.about_page.cta.title }}">
            </div>
            <div class="admin-field">
                <label for="cta_text">–¢–µ–∫—Å—Ç</label>
                <textarea id="cta_text" name="cta_text" rows="2">{{ content.about_page.cta.text }}</textarea>
            </div>
            <div class="admin-field">
                <label for="cta_button_text">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
                <input type="text" id="cta_button_text" name="cta_button_text" value="{{ content.about_page.cta.button_text }}">
            </div>
        </div>

        <button type="submit" class="admin-btn admin-btn--primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
</div>

<script>
function addParagraph() {
    const container = document.getElementById('introParas');
    const div = document.createElement('div');
    div.className = 'admin-field admin-field--removable';
    div.innerHTML = '<textarea name="intro_paragraph" rows="3" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ..."></textarea><button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>';
    container.appendChild(div);
}

function previewField(input, imgId, removeId) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.getElementById(imgId);
            img.src = e.target.result;
            img.parentElement.style.display = '';
        };
        reader.readAsDataURL(input.files[0]);
        if (removeId) {
            document.getElementById(removeId).value = '0';
        }
    }
}

function removeField(blockId, zoneId, removeId) {
    document.getElementById(blockId).style.display = 'none';
    document.getElementById(zoneId).style.display = '';
    document.getElementById(removeId).value = '1';
}
</script>
{% endblock %}
