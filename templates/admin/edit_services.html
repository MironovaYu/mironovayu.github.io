{% extends "admin/base.html" %}
{% block title %}–£—Å–ª—É–≥–∏ ‚Äî –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block admin_content %}
<div class="admin-page">
    <div class="admin-page__header">
        <h1>–°—Ç—Ä–∞–Ω–∏—Ü–∞ ¬´–£—Å–ª—É–≥–∏¬ª</h1>
        <p>–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥, —Ü–µ–Ω—ã –∏ CTA</p>
    </div>

    <form method="POST" class="admin-form">

        <!-- ‚ïê‚ïê‚ïê Page Header ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üìã –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h3>
            <div class="admin-field">
                <label for="page_label">–ú–µ—Ç–∫–∞</label>
                <input type="text" id="page_label" name="page_label" value="{{ content.services_page.label }}">
            </div>
            <div class="admin-field">
                <label for="page_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="page_title" name="page_title" value="{{ content.services_page.title }}">
            </div>
            <div class="admin-field">
                <label for="page_subtitle">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <textarea id="page_subtitle" name="page_subtitle" rows="2">{{ content.services_page.subtitle }}</textarea>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Services ‚ïê‚ïê‚ïê -->
        <div id="servicesContainer">
        {% for svc in content.services_page.services %}
        {% set svc_idx = loop.index0 %}
        <div class="admin-form__section" data-svc-block data-svc-idx="{{ svc_idx }}">
            <div class="admin-section-header">
                <h3>üîπ {{ svc.title }}</h3>
                <button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.closest('[data-svc-block]').remove()">‚úï –£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É</button>
            </div>
            <div class="admin-field">
                <label>ID (—è–∫–æ—Ä—å –¥–ª—è —Å—Å—ã–ª–æ–∫) <small style="color:#999">–õ–∞—Ç–∏–Ω–∏—Ü–∞ –∏ –¥–µ—Ñ–∏—Å—ã, –Ω–∞–ø—Ä. consultation</small></label>
                <input type="text" name="svc_{{ svc_idx }}_id" value="{{ svc.id|default('', true) }}">
            </div>
            <div class="admin-field">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input type="text" name="svc_{{ svc_idx }}_title" value="{{ svc.title }}">
            </div>
            <div class="admin-field">
                <label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" name="svc_{{ svc_idx }}_desc" value="{{ svc.desc }}">
            </div>
            <div class="admin-field">
                <label>–ò–∫–æ–Ω–∫–∞</label>
                <div class="icon-picker-field">
                    <div class="icon-picker-preview" id="iconPreview_svc_{{ svc_idx }}">{% if svc.icon and 'fa-' in svc.icon %}<i class="{{ svc.icon }}"></i>{% else %}<i class="fa-solid fa-icons" style="opacity:0.3"></i>{% endif %}</div>
                    <input type="hidden" name="svc_{{ svc_idx }}_icon" id="iconInput_svc_{{ svc_idx }}" value="{{ svc.icon|default('', true) }}">
                    <button type="button" class="icon-picker-btn" onclick="openIconPicker('svc_{{ svc_idx }}')">–í—ã–±—Ä–∞—Ç—å</button>
                </div>
            </div>
            <div class="admin-field-row">
                <div class="admin-field" style="flex:1">
                    <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</label>
                    <input type="text" name="svc_{{ svc_idx }}_duration" value="{{ svc.duration|default('', true) }}" placeholder="60 –º–∏–Ω—É—Ç">
                </div>
                <div class="admin-field" style="flex:1">
                    <label>–§–æ—Ä–º–∞—Ç</label>
                    <input type="text" name="svc_{{ svc_idx }}_format" value="{{ svc.format|default('', true) }}" placeholder="–û—á–Ω–æ / –û–Ω–ª–∞–π–Ω">
                </div>
            </div>
            <div class="admin-field">
                <label>–î–ª—è –∫–æ–≥–æ <small style="color:#999">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏</small></label>
                <textarea name="svc_{{ svc_idx }}_for_whom" rows="2">{{ svc.for_whom|default('', true) }}</textarea>
            </div>

            <h4>–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h4>
            <div id="svcHighlights_{{ svc_idx }}">
                {% for h in svc.get('highlights', []) %}
                <div class="admin-field admin-field--removable">
                    <input type="text" name="svc_{{ svc_idx }}_highlight" value="{{ h }}">
                    <button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="admin-btn admin-btn--outline" onclick="addSvcHighlight({{ svc_idx }})">+ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ</button>

            <h4 style="margin-top: 1rem;">–¶–µ–Ω—ã</h4>
            <div id="svcPrices_{{ svc_idx }}">
                {% for price in svc.prices %}
                <div class="admin-field-row admin-field--removable" style="display:flex; gap:0.5rem; align-items:flex-start;">
                    <input type="text" name="svc_{{ svc_idx }}_price_label" value="{{ price.label }}" placeholder="–ú–µ—Ç–∫–∞" style="flex:1">
                    <input type="text" name="svc_{{ svc_idx }}_price_value" value="{{ price.value }}" placeholder="–¶–µ–Ω–∞" style="flex:1">
                    <button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="admin-btn admin-btn--outline" onclick="addSvcPrice({{ svc_idx }})">+ –¶–µ–Ω–∞</button>

            <h4 style="margin-top: 1rem;">–û–ø–∏—Å–∞–Ω–∏–µ (–ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã)</h4>
            <div id="svcParas_{{ svc_idx }}">
                {% for p in svc.paragraphs %}
                <div class="admin-field admin-field--removable">
                    <textarea name="svc_{{ svc_idx }}_paragraph" rows="3">{{ p }}</textarea>
                    <button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="admin-btn admin-btn--outline" onclick="addSvcPara({{ svc_idx }})">+ –ü–∞—Ä–∞–≥—Ä–∞—Ñ</button>

            <h4 style="margin-top: 1rem;">–°–ø–∏—Å–æ–∫</h4>
            <div class="admin-field">
                <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ø–∏—Å–∫–∞</label>
                <input type="text" name="svc_{{ svc_idx }}_list_title" value="{{ svc.list_title|default('', true) }}">
            </div>
            <div id="svcList_{{ svc_idx }}">
                {% for li in svc.get('list_items', []) %}
                <div class="admin-field admin-field--removable">
                    <input type="text" name="svc_{{ svc_idx }}_list_item" value="{{ li }}">
                    <button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="admin-btn admin-btn--outline" onclick="addSvcListItem({{ svc_idx }})">+ –ü—É–Ω–∫—Ç —Å–ø–∏—Å–∫–∞</button>
        </div>
        {% endfor %}
        </div>
        <div style="margin-bottom: 1.5rem;">
            <button type="button" class="admin-btn admin-btn--outline" onclick="addService()">+ –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</button>
        </div>

        <!-- ‚ïê‚ïê‚ïê CTA ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üì¢ CTA-—Å–µ–∫—Ü–∏—è</h3>
            <div class="admin-field">
                <label for="cta_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="cta_title" name="cta_title" value="{{ content.services_page.cta.title }}">
            </div>
            <div class="admin-field">
                <label for="cta_text">–¢–µ–∫—Å—Ç</label>
                <textarea id="cta_text" name="cta_text" rows="2">{{ content.services_page.cta.text }}</textarea>
            </div>
            <div class="admin-field">
                <label for="cta_button_text">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
                <input type="text" id="cta_button_text" name="cta_button_text" value="{{ content.services_page.cta.button_text }}">
            </div>
        </div>

        <button type="submit" class="admin-btn admin-btn--primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
</div>

<script>
var svcCounter = {{ content.services_page.services|length }};

function addSvcPara(idx) {
    var container = document.getElementById('svcParas_' + idx);
    var div = document.createElement('div');
    div.className = 'admin-field admin-field--removable';
    div.innerHTML = '<textarea name="svc_' + idx + '_paragraph" rows="3" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ..."></textarea><button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>';
    container.appendChild(div);
}

function addSvcListItem(idx) {
    var container = document.getElementById('svcList_' + idx);
    var div = document.createElement('div');
    div.className = 'admin-field admin-field--removable';
    div.innerHTML = '<input type="text" name="svc_' + idx + '_list_item" placeholder="–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç..."><button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>';
    container.appendChild(div);
}

function addSvcHighlight(idx) {
    var container = document.getElementById('svcHighlights_' + idx);
    var div = document.createElement('div');
    div.className = 'admin-field admin-field--removable';
    div.innerHTML = '<input type="text" name="svc_' + idx + '_highlight" placeholder="–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ..."><button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>';
    container.appendChild(div);
}

function addSvcPrice(idx) {
    var container = document.getElementById('svcPrices_' + idx);
    var div = document.createElement('div');
    div.className = 'admin-field-row admin-field--removable';
    div.style.cssText = 'display:flex; gap:0.5rem; align-items:flex-start;';
    div.innerHTML = '<input type="text" name="svc_' + idx + '_price_label" placeholder="–ú–µ—Ç–∫–∞" style="flex:1"><input type="text" name="svc_' + idx + '_price_value" placeholder="–¶–µ–Ω–∞" style="flex:1"><button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.parentElement.remove()">‚úï</button>';
    container.appendChild(div);
}

function addService() {
    var idx = svcCounter++;
    var container = document.getElementById('servicesContainer');
    var section = document.createElement('div');
    section.className = 'admin-form__section';
    section.setAttribute('data-svc-block', '');
    section.setAttribute('data-svc-idx', idx);
    section.innerHTML = '<div class="admin-section-header"><h3>üîπ –ù–æ–≤–∞—è —É—Å–ª—É–≥–∞</h3><button type="button" class="admin-btn admin-btn--sm admin-btn--danger" onclick="this.closest(\'[data-svc-block]\').remove()">‚úï –£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É</button></div>'
        + '<div class="admin-field"><label>ID (—è–∫–æ—Ä—å)</label><input type="text" name="svc_' + idx + '_id" placeholder="my-service"></div>'
        + '<div class="admin-field"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" name="svc_' + idx + '_title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏"></div>'
        + '<div class="admin-field"><label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label><input type="text" name="svc_' + idx + '_desc" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"></div>'
        + '<div class="admin-field"><label>–ò–∫–æ–Ω–∫–∞</label><div class="icon-picker-field"><div class="icon-picker-preview" id="iconPreview_svc_' + idx + '"><i class="fa-solid fa-icons" style="opacity:0.3"></i></div><input type="hidden" name="svc_' + idx + '_icon" id="iconInput_svc_' + idx + '" value=""><button type="button" class="icon-picker-btn" onclick="openIconPicker(\'svc_' + idx + '\')">–í—ã–±—Ä–∞—Ç—å</button></div></div>'
        + '<div class="admin-field-row"><div class="admin-field" style="flex:1"><label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</label><input type="text" name="svc_' + idx + '_duration" placeholder="60 –º–∏–Ω—É—Ç"></div><div class="admin-field" style="flex:1"><label>–§–æ—Ä–º–∞—Ç</label><input type="text" name="svc_' + idx + '_format" placeholder="–û—á–Ω–æ / –û–Ω–ª–∞–π–Ω"></div></div>'
        + '<div class="admin-field"><label>–î–ª—è –∫–æ–≥–æ</label><textarea name="svc_' + idx + '_for_whom" rows="2" placeholder="–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è..."></textarea></div>'
        + '<h4>–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h4><div id="svcHighlights_' + idx + '"></div><button type="button" class="admin-btn admin-btn--outline" onclick="addSvcHighlight(' + idx + ')">+ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ</button>'
        + '<h4 style="margin-top:1rem">–¶–µ–Ω—ã</h4><div id="svcPrices_' + idx + '"></div><button type="button" class="admin-btn admin-btn--outline" onclick="addSvcPrice(' + idx + ')">+ –¶–µ–Ω–∞</button>'
        + '<h4 style="margin-top:1rem">–û–ø–∏—Å–∞–Ω–∏–µ (–ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã)</h4><div id="svcParas_' + idx + '"></div><button type="button" class="admin-btn admin-btn--outline" onclick="addSvcPara(' + idx + ')">+ –ü–∞—Ä–∞–≥—Ä–∞—Ñ</button>'
        + '<h4 style="margin-top:1rem">–°–ø–∏—Å–æ–∫</h4><div class="admin-field"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ø–∏—Å–∫–∞</label><input type="text" name="svc_' + idx + '_list_title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ø–∏—Å–∫–∞"></div><div id="svcList_' + idx + '"></div><button type="button" class="admin-btn admin-btn--outline" onclick="addSvcListItem(' + idx + ')">+ –ü—É–Ω–∫—Ç —Å–ø–∏—Å–∫–∞</button>';
    container.appendChild(section);
}
</script>
{% endblock %}
